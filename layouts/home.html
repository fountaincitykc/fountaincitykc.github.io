{{ define "main" }}
  <main class="main-content | home">

    {{/* Directions */}}
    <div class="home-directions | animate">
      {{ with site.Params.serviceAddress }}
        <address>
          <strong>{{ .text }}</strong><br>
          {{ .address }}
        </address>
      {{ end }}
      {{ with site.Params.directions }}
        {{ partial "components/button" (dict "href" .href "text" .text "variant" "primary" )}}
      {{ end }}
    </div>

    {{/* Hero */}}
    {{ with .Params.hero }}
      <div class="home-hero | animate">
        <h1>
          {{ .headline }}
        </h1>
        <img src="/images/fountain-city-church-logo.svg" alt="Fountain City Church" class="img img--center">
        <h4>
          {{ .subhead }}
          {{ with .button }}
            <span id="watch-live" class="watch-live hide">
              — <a href="{{ .href }}">{{ .text }}</a>
            </span>
          {{ end }}
        </h4>
      </div>
    {{ end }}

    {{/* Banner */}}
    {{ if .Params.banner.enabled }}
      {{ with .Params.banner }}
        <div class="home-banner | animate">
          <div class="home-banner__content">
            {{ .content | $.Page.RenderString (dict "display" "block") }}
          </div>
          {{ with .button }}
            {{ if and .href .text }}
              <div class="home-banner__button">
                {{ partial "components/button" (dict "href" .href "text" .text "variant" "primary" )}}
              </div>
            {{ end }}
          {{ end }}
        </div>
      {{ end }}
    {{ end }}

    {{/* Photos */}}
    {{ with .Params.photos }}
      <div class="home-photos | animate">
        {{ range $k, $v := . }}
          {{ with $.Resources.Get (printf "home/%s" (path.Base $v)) }}
              <img class="home-photos__{{ $k }}" src="{{ .RelPermalink }}" alt="Photo">
          {{ end }}
        {{ end }}
      </div>
    {{ end }}

    {{/* Callout */}}
    {{ with .Params.callout }}
      <div class="container">
        <div class="home-callout | callout callout--dark | animate">
          <div class="callout__content">
            {{ .content | $.Page.RenderString (dict "display" "block") }}
          </div>
          {{ with .link }}
            <div class="callout__footer">
              <a href="{{ .href }}">{{ .text }}</a>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}

    {{/* Cards */}}
    {{ with .Params.cards }}
      <div class="container">
        <div class="home-cards">
          {{ range . }}
            <div class="card | animate">
              <div class="card__media">
                {{ with $.Resources.Get (printf "home/%s" (path.Base .photo)) }}
                  <img src="{{ .RelPermalink }}" alt="{{ path.BaseName .Title | humanize }}" class="img img--fill img--h256 img--cover">
                {{ end }}
              </div>
              <div class="card__body">
                <div class="card__header">
                  <h3>
                    {{ .headline }}
                  </h3>
                </div>
                <div class="card__content">
                  {{ .content | $.Page.RenderString (dict "display" "block") }}
                </div>
                {{ with .button }}
                  <div class="card__footer">
                    {{ partial "components/button" (dict "href" .href "text" .text "variant" "secondary" )}}
                  </div>
                {{ end }}
              </div>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}

    {{/* Latest sermon */}}
    {{ range first 1 (where site.RegularPages "Section" "sermons") }}
      <div class="container">
        <div class="home-sermon | content-section | animate">
          <div class="content-section__media">
            <a href="{{ .RelPermalink }}">
              {{ with $.Resources.Get (printf "home/%s" (path.Base $.Params.sermon.photo)) }}
                <img src="{{ .RelPermalink }}" alt="Latest sermon" class="img img--fill img--rounded">
              {{ end }}
            </a>
          </div>
          <div class="content-section__body">
            <div class="content-section__header">
              <h2>
                {{ $.Params.sermon.headline }}
              </h2>
              <h3 class="subtitle">
                {{ dateFormat "January 2, 2006" .Date }} — {{ .Title }}
              </h3>
            </div>
            <div class="content-section__content">
              {{ .Content }}
            </div>
            <div class="content-section__footer">
              {{ $sermon := . }}
              {{ with $.Params.sermon.watch }}
                {{ partial "components/button" (dict "href" $sermon.RelPermalink "text" .text "variant" "primary" )}}
              {{ end }}
              {{ with $.Params.sermon.listen }}
                {{ partial "components/button" (dict "href" .href "text" .text "variant" "primary" )}}
              {{ end }}
            </div>
          </div>
        </div>
      </div>
    {{ end }}

    {{/* Featured events */}}
    {{ $today := time.AsTime (now.Format "2006-01-02") }}
    {{/* Get all events */}}
    {{ $events := where site.RegularPages "Section" "events" }}
    {{/* Filter down to featured events */}}
    {{ $featuredEvents := where $events "Params.featured" true }}
    {{/* Filter down to upcoming featured events */}}
    {{ $futureEvents := where $featuredEvents "Date" "ge" $today }}
    {{/* Filter down to the next 3 upcoming featured events */}}
    {{ $upcomingEvents := sort $futureEvents "Date" "asc" | first 3 }}
    {{/* Handle layout for 1 event or multiple events */}}
    {{ $eventLen := $upcomingEvents | len }}
    {{ if gt $eventLen 0 }}
      <div class="container">
        <div class="home-events home-events--len-{{ $eventLen }}">
          {{/* Layout for 1 event */}}
          {{ if eq $eventLen 1 }}
            {{ with index $upcomingEvents 0 }}
              <div class="content-section | animate">
                <div class="content-section__media">
                  {{ $src := default site.Params.events.defaultImage .Params.image }}
                  {{ with resources.Get (printf "events/%s" (path.Base $src)) }}
                    <img src="{{ .RelPermalink }}" alt="{{ path.BaseName .Title | humanize }}" class="img img--fill img--rounded">
                  {{ end }}
                </div>
                <div class="content-section__body">
                  <div class="content-section__header">
                    <h2>
                      {{ $.Page.Params.events.headline.single }}
                    </h2>
                    {{ .Render "event-title" }}
                    {{ .Render "event-date" }}
                    {{ .Render "event-location" }}
                  </div>
                  <div class="content-section__content">
                    {{ .Render "event-summary" }}
                  </div>
                  {{ with .Params.button }}
                    <div class="content-section__footer">
                      {{ partial "components/button" (dict "href" .href "text" .text "variant" "primary" )}}
                    </div>
                  {{ end }}
                </div>
              </div>
            {{ end }}
          {{/* Layout for multiple events */}}
          {{ else }}
            <h2 class="home-events__headline | animate">
              {{ .Params.events.headline.multiple }}
            </h2>
            <div class="home-events__cards">
              {{ range $upcomingEvents }}
                <div class="card | animate">
                  <div class="card__media">
                    {{ $src := default site.Params.events.defaultImage .Params.image }}
                    {{ with resources.Get (printf "events/%s" (path.Base $src)) }}
                      <img src="{{ .RelPermalink }}" alt="{{ path.BaseName .Title | humanize }}" class="img img--fill img--h256 img--cover">
                    {{ end }}
                  </div>
                  <div class="card__body">
                    <div class="card__header">
                      {{ .Render "event-title" }}
                      {{ .Render "event-date" }}
                      {{ .Render "event-location" }}
                    </div>
                    <div class="card__content">
                      {{ .Render "event-summary" }}
                    </div>
                    {{ with .Params.button }}
                      <div class="card__footer">
                        {{ partial "components/button" (dict "href" .href "text" .text "variant" "secondary" )}}
                      </div>
                    {{ end }}
                  </div>
                </div>
              {{ end }}
            </div>
            {{ with .Params.events.button }}
              <p class="home-events__footer | animate">
                <a href="{{ .href }}">{{ .text }}</a>
              </p>
            {{ end }}
          {{ end }}
        </div>
      </div>
    {{ end }}
    
  </main>
{{ end }}
