{{ define "main" }}
  <main class="main-content | home">

    {{/* Directions */}}
    <div class="home-directions | animate">
      {{ with site.Params.serviceAddress }}
        <address>
          <strong>{{ .text }}</strong><br>
          {{ .address }}
        </address>
      {{ end }}
      {{ with site.Params.directions }}
        {{ partial "components/button.html" (dict "href" .href "text" .text "variant" "primary" )}}
      {{ end }}
    </div>

    {{/* Hero */}}
    {{ with .Params.hero }}
      <div class="home-hero | animate">
        <h1>
          {{ .headline }}
        </h1>
        {{ with $.Resources.Get .image }}
          <img src="{{ .RelPermalink }}" alt="Fountain City Church" class="img img--center">
        {{ end }}
        <h4>
          {{ .subhead }}
          {{ with .button }}
            <span id="watch-live" class="watch-live hide">
              &ndash; <a href="{{ .href }}">{{ .text }}</a>
            </span>
          {{ end }}
        </h4>
      </div>
    {{ end }}

    {{/* Banner */}}
    {{ if .Params.banner.enabled }}
      {{ with .Params.banner }}
        <div class="home-banner | animate">
          <div class="mrpancake">
            <img src="/home/mrpancake.png" alt="" width="80" height="100">
          </div>
          <div class="home-banner__content">
            {{ .content | $.Page.RenderString (dict "display" "block") }}
          </div>
          {{ with .button }}
            <div class="home-banner__button">
              {{ partial "components/button.html" (dict "href" .href "text" .text "variant" "primary" )}}
            </div>
          {{ end }}
        </div>
      {{ end }}
    {{ end }}

    {{/* Photos */}}
    <div class="home-photos | animate">
      <div class="home-photos-main"><img src="/home/photo-main.jpg" alt="Photo"></div>
      <div class="home-photos-1"><img src="/home/photo-1.jpg" alt="Photo"></div>
      <div class="home-photos-2"><img src="/home/photo-2.jpg" alt="Photo"></div>
      <div class="home-photos-3"><img src="/home/photo-3.jpg" alt="Photo"></div>  
      <div class="home-photos-4"><img src="/home/photo-4.jpg" alt="Photo"></div>
      <div class="home-photos-5"><img src="/home/photo-5.jpg" alt="Photo"></div>
      <div class="home-photos-6"><img src="/home/photo-6.jpg" alt="Photo"></div>
    </div>

    {{/* Callout */}}
    {{ with .Params.callout }}
      <div class="container">
        <div class="home-callout | callout callout--dark | animate">
          <div class="callout__content">
            {{ .content | $.Page.RenderString (dict "display" "block") }}
          </div>
          {{ with .link }}
            <div class="callout__footer">
              <a href="{{ .href }}">{{ .text }}</a>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}

    {{/* Cards */}}
    {{ with .Params.cards }}
      <div class="container">
        <div class="home-cards">
          {{ range . }}
            <div class="card | animate">
              <div class="card__media">
                <img src="{{ .photo }}" alt="{{ .headline }}" class="img img--fill img--h256 img--cover">
              </div>
              <div class="card__body">
                <div class="card__header">
                  <h3>
                    {{ .headline }}
                  </h3>
                </div>
                <div class="card__content">
                  {{ .content | $.Page.RenderString (dict "display" "block") }}
                </div>
                {{ with .button }}
                  <div class="card__footer">
                    {{ partial "components/button.html" (dict "href" .href "text" .text "variant" "secondary" )}}
                  </div>
                {{ end }}
              </div>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}

    {{/* Latest sermon */}}
    {{ with .Params.sermon }}
      {{ $latestSermon := newScratch }}
      {{ range first 1 (where site.RegularPages "Section" "sermons") }}
        {{ $latestSermon.Set "link" .RelPermalink }}
        {{ $latestSermon.Set "date" (dateFormat "January 2, 2006" .Date) }}
        {{ $latestSermon.Set "title" .Title }}
        {{ $latestSermon.Set "content" .Content }}
        {{ $latestSermon.Set "series" .Params.series }}
        {{ $latestSermon.Set "image" .Params.image }}
      {{ end }}
      <div class="container">
        <div class="home-sermon | content-section | animate">
          <div class="content-section__media">
            <figure class="sermon-image">
              {{ with $latestSermon.Get "series" }}
                {{ with index site.Params.sermons.series . }}
                  {{ $src := default .image ($latestSermon.Get "image") }}
                  <img src="{{ $src }}" alt="{{ .title }}" class="img img--fill">
                  <figcaption>
                    {{ .title }}
                  </figcaption>
                {{ end }}
              {{ else }}
              {{ $src := default site.Params.sermons.defaultImage ($latestSermon.Get "image") }}
                <img src="{{ $src }}" alt="{{ $latestSermon.Get "title" }}" class="img img--fill img--rounded">
              {{ end }}
            </figure>
          </div>
          <div class="content-section__body">
            <div class="content-section__header">
              <h2>
                {{ .headline }}
              </h2>
              <h3 class="subtitle">
                {{ $latestSermon.Get "date" }} &ndash; {{ $latestSermon.Get "title" }}
              </h3>
            </div>
            <div class="content-section__content">
              {{ $latestSermon.Get "content" }}
            </div>
            <div class="content-section__footer">
              {{ with .watch }}
                {{ partial "components/button.html" (dict "href" ($latestSermon.Get "link") "text" .text "variant" "primary" )}}
              {{ end }}
              {{ with .listen }}
                {{ partial "components/button.html" (dict "href" .href "text" .text "variant" "primary" )}}
              {{ end }}
            </div>
          </div>
        </div>
      </div>
    {{ end }}

    {{/* Featured events */}}
    {{ $today := time.AsTime (now.Format "2006-01-02") }}
    {{/* Get all events */}}
    {{ $events := where site.RegularPages "Section" "events" }}
    {{/* Filter down to featured events */}}
    {{ $featuredEvents := where $events "Params.featured" true }}
    {{/* Filter down to upcoming featured events */}}
    {{ $futureEvents := where $featuredEvents "Date" "ge" $today }}
    {{/* Filter down to the next 3 upcoming featured events */}}
    {{ $upcomingEvents := sort $futureEvents "Date" "asc" | first 3 }}
    {{/* Handle layout for 1 event or multiple events */}}
    {{ $eventLen := $upcomingEvents | len }}
    {{ if gt $eventLen 0 }}
      <div class="container">
        <div class="home-events home-events--len-{{ $eventLen }}">
          {{/* Layout for 1 event */}}
          {{ if eq $eventLen 1 }}
            {{ with index $upcomingEvents 0 }}
              <div class="content-section | animate">
                <div class="content-section__media">
                  {{ $eventImage := default site.Params.events.defaultImage .Params.image }}
                  <img src="{{ $eventImage }}" alt="{{ .Title }}" class="img img--fill img--rounded">
                </div>
                <div class="content-section__body">
                  <div class="content-section__header">
                    <h2>
                      {{ $.Page.Params.events.headline.single }}
                    </h2>
                    {{ .Render "event-title" }}
                    {{ .Render "event-date" }}
                    {{ .Render "event-location" }}
                  </div>
                  <div class="content-section__content">
                    {{ .Render "event-summary" }}
                  </div>
                  {{ with .Params.button }}
                    <div class="content-section__footer">
                      {{ partial "components/button.html" (dict "href" .href "text" .text "variant" "primary" )}}
                    </div>
                  {{ end }}
                </div>
              </div>
            {{ end }}
          {{/* Layout for multiple events */}}
          {{ else }}
            <h2 class="home-events__headline | animate">
              {{ .Params.events.headline.multiple }}
            </h2>
            <div class="home-events__cards">
              {{ range $upcomingEvents }}
                <div class="card | animate">
                  <div class="card__media">
                    {{ $eventImage := default site.Params.events.defaultImage .Params.image }}
                    <img src="{{ $eventImage }}" alt="{{ .Title }}" class="img img--fill img--h256 img--cover">
                  </div>
                  <div class="card__body">
                    <div class="card__header">
                      {{ .Render "event-title" }}
                      {{ .Render "event-date" }}
                      {{ .Render "event-location" }}
                    </div>
                    <div class="card__content">
                      {{ .Render "event-summary" }}
                    </div>
                    {{ with .Params.button }}
                      <div class="card__footer">
                        {{ partial "components/button.html" (dict "href" .href "text" .text "variant" "secondary" )}}
                      </div>
                    {{ end }}
                  </div>
                </div>
              {{ end }}
            </div>
            {{ with .Params.events.button }}
              <p class="home-events__footer | animate">
                <a href="{{ .href }}">{{ .text }}</a>
              </p>
            {{ end }}
          {{ end }}
        </div>
      </div>
    {{ end }}
    
  </main>
{{ end }}
